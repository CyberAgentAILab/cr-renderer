import datasets  # type: ignore
import pytest
from datasets import load_dataset_builder
from PIL import Image

from cr_renderer.renderer import CrelloV5Renderer

EXAMPLE = {
    "id": "xxx",
    "length": 13,
    "group": 0,
    "format": 11,
    "canvas_width": 1000,
    "canvas_height": 1500,
    "category": 0,
    "title": "Week Sale Of Bygone Century Furnishings",
    "suitability": [0],
    "keywords": ["antique"],
    "industries": [14, 2],
    "preview": Image.new("RGB", (100, 150), color="white"),
    "type": [4, 0, 0, 0, 3, 0, 8, 8, 2, 1, 1, 1, 1],
    "left": [
        0.0,
        150.5,
        282.5,
        218.99220275878906,
        149.99830627441406,
        182.4921875,
        198.94407653808594,
        753.055908203125,
        149.98097229003906,
        749.1275634765625,
        0.0,
        0.0,
        749.1275634765625,
    ],
    "top": [
        0.0,
        145.3705596923828,
        75.46675872802734,
        1394.533203125,
        1243.575927734375,
        1265.5557861328125,
        360.1622314453125,
        360.1622314453125,
        553.397705078125,
        0.0,
        0.0,
        1293.0302734375,
        1293.0302734375,
    ],
    "width": [
        1000.0,
        699.0,
        435.0,
        566.0,
        700.0033569335938,
        635.0,
        48.0,
        48.0,
        700.0380859375,
        250.87245178222656,
        250.87245178222656,
        250.87245178222656,
        250.87245178222656,
    ],
    "height": [
        1500.0,
        342.0,
        30.0,
        30.0,
        110.95980072021484,
        67.0,
        145.3898468017578,
        145.3898468017578,
        623.7451171875,
        206.9697723388672,
        206.9697723388672,
        206.9697723388672,
        206.9697723388672,
    ],
    "angle": [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 90.0, 90.0, 0.0, 0.0, 0.0, 0.0, 0.0],
    "opacity": [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
    "color": [
        ["rgba(52, 103, 151, 1)"],
        [],
        [],
        [],
        ["rgba(52, 103, 151, 1)"],
        [],
        ["rgba(214, 215, 217, 1)"],
        ["rgba(214, 215, 217, 1)"],
        [],
        ["rgba(255, 255, 255, 1)"],
        ["rgba(255, 255, 255, 1)"],
        ["rgba(255, 255, 255, 1)"],
        ["rgba(255, 255, 255, 1)"],
    ],
    "image": [
        Image.new("RGBA", size=(240, 360)),
        Image.new("RGBA", size=(360, 176)),
        Image.new("RGBA", size=(360, 25)),
        Image.new("RGBA", size=(360, 19)),
        Image.new("RGBA", size=(360, 57)),
        Image.new("RGBA", size=(360, 38)),
        Image.new("RGBA", size=(48, 145)),
        Image.new("RGBA", size=(48, 145)),
        Image.new("RGBA", size=(360, 321)),
        Image.new("RGBA", size=(251, 207)),
        Image.new("RGBA", size=(251, 207)),
        Image.new("RGBA", size=(251, 207)),
        Image.new("RGBA", size=(251, 207)),
    ],
    "text": [
        "",
        "Antique\nFurniture Sale",
        "- Shop Name -",
        "We are waiting for you",
        "",
        "only this week",
        "",
        "",
        "",
        "",
        "",
        "",
        "",
    ],
    "font": [0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0],
    "font_size": [
        0.0,
        114.0,
        30.0,
        30.0,
        0.0,
        67.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
    ],
    "font_bold": [
        [],
        [
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            False,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
        ],
        [
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
        ],
        [
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
        ],
        [],
        [
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
        ],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
    ],
    "font_italic": [
        [],
        [
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
        ],
        [
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
        ],
        [
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
            True,
        ],
        [],
        [
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
            False,
        ],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
    ],
    "text_line": [
        [],
        [0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
    ],
    "text_color": [
        [],
        [
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(0, 0, 0, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
        ],
        [
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
        ],
        [
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
        ],
        [],
        [
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
            "rgba(255, 255, 255, 1)",
        ],
        [],
        [],
        [],
        [],
        [],
        [],
        [],
    ],
    "text_align": [0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0],
    "capitalize": [
        False,
        True,
        True,
        False,
        False,
        True,
        False,
        False,
        False,
        False,
        False,
        False,
        False,
    ],
    "line_height": [
        1.0,
        1.0,
        1.0,
        1.0,
        1.0,
        1.0,
        1.0,
        1.0,
        1.0,
        1.0,
        1.0,
        1.0,
        1.0,
    ],
    "letter_spacing": [
        0.0,
        0.0,
        4.214654445648193,
        4.214654445648193,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
        0.0,
    ],
    "cluster_index": 0,
}


@pytest.fixture(scope="module")
def features_v5():
    builder = load_dataset_builder("cyberagent/crello", revision="5.0.0")
    yield builder.info.features


def test_crello_v5_renderer(features_v5: datasets.Features):
    renderer = CrelloV5Renderer(features=features_v5)
    assert isinstance(renderer.render(example=EXAMPLE), bytes)
